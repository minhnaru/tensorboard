<!--
Minh
For Edge Interaction
-->

<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item-body.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../tf-graph-common/tf-graph-common.html">
<link rel="import" href="tf-graph-icon.html">
<link rel="import" href="tf-node-list-item.html">

<dom-module id="tf-edge-info">
  <style>
    .sub-list-group {
      font-weight: 500;
      font-size: 12pt;
      padding-bottom: 8px;
      width: 100%;
    }

    .sub-list {
      max-height: 300px;
      overflow-y: scroll;
    }

    .sub-list-second {
      color: #565656;
      display: inline;
      font-size: 11pt;
      font-weight: 400;
      max-width: 200px;
      padding: 0 4px;
    }

    paper-item {
      padding: 0;
      background: #e9e9e9;
    }

    paper-item-body[two-line] {
      min-height: 0;
      padding: 8px 12px 4px;
    }

    .expandedInfo {
      padding: 8px 12px;
    }

    .edge-name {
      white-space: normal;
      word-wrap: break-word;
      font-size: 14pt;
      font-weight: 500;
    }

    .edge-icon {
      float: right;
    }

    .subtitle {
      font-size: 12pt;
      color: #5e5e5e;
    }

    .toggle-button {
      float: right;
      max-height: 20px;
      max-width: 20px;
      padding: 0;
    }

    .control-toggle-button {
      float: left;
      max-height: 20px;
      max-width: 20px;
      padding: 0;
    }

    .toggle-include-group {
      padding-top: 4px;
    }

    .toggle-include {
      margin: 5px 6px;
      text-transform: none;
      padding: 4px 6px;
      font-size: 10pt;
      background-color: #fafafa;
      color: #666;
    }

    .toggle-include:hover {
      background-color: var(--google-yellow-100);
    }

    .non-control-list-item {
      padding-left: 10px;
    }

    .show {
      display: block;
    }

    .hidden {
      display: none;
    }
  </style>
  <template>
    <paper-item>
      <paper-item-body two-line>
        <div>
          <paper-icon-button icon="{{_getToggleIcon(_expanded)}}" on-click="_toggleExpanded" class="toggle-button">
          </paper-icon-button>
          <div class="edge-name" id="edgetitle"></div>
        </div>
        <div secondary>
            [[_hinfo]] [[_info]]
        </div>
      </paper-item-body>
    </paper-item>
    <iron-collapse opened="{{_expanded}}">
      <template is="dom-if" if="{{_expanded}}" restamp="true">
        <div class="expandedInfo">
          <div class="sub-list-group">
            Head: <span class="sub-list sub-list-second">[[_head]]</span>
          </div>
          <div class="sub-list-group">
            Tail: <span class="sub-list sub-list-second">[[_tail]]</span>
          </div>
        </div>
      </template>
    </iron-collapse>
  </template>

  <script>
    (function () {
      Polymer({
        is: 'tf-edge-info',

        properties: {
          edgeName: String,
          graphHierarchy: Object,
          renderHierarchy: Object,
          /** What to color the nodes by (compute time, memory, device etc.) */
          colorBy: String,
          _edge: {
            type: Object,
            computed: '_getEdge(edgeName)',
            observer: '_resetState'
          },
          _head: {
            type: Object,
            computed: '_getHead(edgeName)'
          },
          _tail: {
            type: Object,
            computed: '_getTail(edgeName)'
          },
          _info: {
            type: Object,
            computed: '_getInfo(edgeName)'
          },
          _hinfo: {
            type: Object,
            computed: '_getHInfo(edgeName)'
          },
          _expanded: {
            type: Boolean,
            value: true
          },
          _auxButtonText: String,
          _groupButtonText: String
        },
        _getSplit: function (edgeName) {
          let splitName = edgeName.split('--');
          return splitName;
        },
        _getEdge: function (edgeName) {
          if (edgeName != null) {
            return this._getSplit(edgeName)[0];
          }
        },
        _getHead: function (edgeName) {
          if (edgeName != null) {
            return this._getSplit(edgeName)[1];
          }
        },
        _getTail: function (edgeName) {
          if (edgeName != null) {
            return this._getSplit(edgeName)[2];
          }
        },
        _getInfo: function (edgeName) {
          if (edgeName != null) {
            if (this._getSplit(edgeName)[1] == this._getSplit(edgeName)[5]) {
              return this._getSplit(edgeName)[4];
            } else {
              return null;
            }
          }
        },
        _getHInfo: function (edgeName) {
          if (edgeName != null) {
            if (this._getSplit(edgeName)[1] == this._getSplit(edgeName)[5]) {
              return "(" + this._getSplit(edgeName)[3] + ")" + " - ";
            } else {
              return null;
            }
          }
        },
        _toggleExpanded: function () {
          this._expanded = !this._expanded;
        },
        _getToggleIcon: function (expanded) {
          return expanded ? "expand-less" : "expand-more";
        },
        _resizeList: function (selector) {
          var list = document.querySelector(selector);
          if (list) {
            list.fire('iron-resize');
          }
        },
        _getPrintableHTMLEdgeName: function (edgeName) {
          // Insert an optional line break before each slash so that
          // long node names wrap cleanly at path boundaries.
          return (edgeName || '').replace(/\//g, '<wbr>/');
        },
        _resetState: function () {
          if (this._edge) {
            Polymer.dom(this.$.edgetitle).innerHTML =
              this._getPrintableHTMLEdgeName(this._edge);
          }
        }
      });
    })();
  </script>
</dom-module>